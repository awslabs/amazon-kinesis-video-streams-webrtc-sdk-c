cmake_minimum_required(VERSION 3.6.3)

project(libcorejson NONE)

if (BUILD_STATIC_LIBS OR WIN32)
  set(LIBCOREJSON_SHARED_LIBS OFF)
else()
  set(LIBCOREJSON_SHARED_LIBS ON)
endif()

include(ExternalProject)
ExternalProject_Add(libcorejson
    GIT_REPOSITORY    https://github.com/FreeRTOS/coreJSON.git
    GIT_TAG           dc1ab9130a1fb99b801a2a1fa8e9f42239f752be
    PREFIX            ${CMAKE_CURRENT_BINARY_DIR}/build
    PATCH_COMMAND     git apply --ignore-whitespace ${CMAKE_CURRENT_LIST_DIR}/libcorejson-add-cmakelists.patch
    CMAKE_ARGS
        -DCMAKE_INSTALL_PREFIX=${OPEN_SRC_INSTALL_PREFIX}
        -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
        -DBUILD_SHARED_LIBS=${LIBCOREJSON_SHARED_LIBS}
        "-DCMAKE_C_FLAGS=${CMAKE_C_FLAGS} -fPIC"
    BUILD_ALWAYS      TRUE
    TEST_COMMAND      ""
)
